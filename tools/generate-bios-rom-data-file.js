#!/usr/bin/env node

const fs = require('fs/promises');
const path = require('path');

async function generateBiosRomDataFile(romFilePath, outputFilePath) {
  const romContent = await fs.readFile(romFilePath);
  const outputFileContent = [
    `// BIOS ROM data automatically generated by generate-bios-rom-data-file.js`,
    `// Source: ${path.basename(romFilePath)}`,
    '',
    '#include <stdint.h>',
    '',
    'const uint8_t kBIOSROMData[] = {',
    Array.from(romContent)
      .map(
        (byte, index) =>
          (index % 16 === 0 && index > 0 ? `\n` : '') +
          `0x${byte.toString(16).padStart(2, '0')},`
      )
      .join(''),
    '};',
    '',
    'const uint32_t kBIOSROMDataSize = sizeof(kBIOSROMData);',
    '',
  ].join('\n');
  await fs.writeFile(outputFilePath, outputFileContent, 'utf8');
}

if (require.main === module) {
  const args = process.argv.slice(2);
  if (args.length < 2) {
    console.error('Usage: generate-bios-rom-data-file.js XXX.ROM XXX.c');
    process.exit(1);
  }
  const romFilePath = args[0];
  const outputFilePath = args[1];

  (async () => {
    await generateBiosRomDataFile(romFilePath, outputFilePath);
  })();
}
